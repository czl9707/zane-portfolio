---
import { themeVars, type ColorVariation } from "@/lib/theme";
import type { HTMLTag, Polymorphic } from "astro/types";

type ButtonColorVariation = ColorVariation | "transparent";

type Props<Tag extends HTMLTag> = Polymorphic<{
  as: Tag;
  variant?: "outlined" | "filled";
  color?: ButtonColorVariation;
  disabled?: boolean;
}>;

// interface Props extends HTMLAttributes<"button"> 

const { 
  variant = "outlined", 
  color = "primary", 
  class: className, 
  as: Tag = "button",
  disabled = false,
  style,
  ...others
} = Astro.props as Props<HTMLTag>;

let textColor, backgroundColor, maskColor;

if (variant === "outlined")
{
    textColor = themeVars.color[color === 'transparent' ? 'primary' : color].foreground;
    backgroundColor = color === "transparent" ? "transparent" : themeVars.color[color].background;
    maskColor = themeVars.color.primary.foreground;
}
else {
    textColor = color === "transparent" ? themeVars.color.primary.foreground : themeVars.color[color].background;
    backgroundColor = color === "transparent" ? "transparent" : themeVars.color[color].foreground;
    maskColor = themeVars.color.primary[color === "transparent" ? "foreground" : "background"];
}
---

<Tag class:list={[
  "ButtonContainer", 
  variant === "filled" ? "FilledButtonContainer" : "OutlineButtonContainer",
  className
]} data-disabled={disabled} 
style={{
  ...(style ?? {}),
  "--button-text-color": textColor,
  "--button-background-color": backgroundColor,
  "--button-mask-color": maskColor,
}}
{...others}>
  <div class:list={["ButtonMask"]}></div>
  <slot />
</Tag>

<style
  define:vars={{
    "button-text-color": textColor,
    "button-background-color": backgroundColor,
    "button-mask-color": maskColor,
  }}
>
  .ButtonContainer {
    border-radius: var(--size-border-radius);
    box-sizing: border-box;

    font-family: var(--typography-button-fontFamily);
    font-size: var(--typography-button-fontSize);
    font-weight: var(--typography-button-fontWeight);
    line-height: var(--typography-button-lineHeight);
    position: relative;
    cursor: pointer;
    user-select: none;
    overflow: hidden;
    padding: 0.5rem 1rem;
    margin: 0;
    min-height: calc(var(--typography-button-fontSize) * var(--typography-button-lineHeight) + 1rem);

		display: flex;
		flex-direction: row;
		gap: 0.5rem;
		align-items: center;

    color: rgb(var(--button-text-color));
    background-color: rgb(var(--button-background-color));

    .ButtonMask {
      display: block;
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-color: transparent;
      transition: background-color var(--transition-short);
    }

    &[data-disabled="true"] {
      pointer-events: none;
      opacity: 0.5;
    }

    &:hover {
      .ButtonMask {
        background-color: rgb(var(--button-mask-color) / 0.1);
      }
    }

    &:active {
      .ButtonMask {
        background-color: rgb(var(--button-mask-color) / 0.2);
      }
    }
  }

  .OutlineButtonContainer {
    border: 1px solid rgb(var(--button-text-color));
  }

  .FilledButtonContainer {
    border: 1px solid rgb(var(--button-background-color));
  }
</style>

